<div class="editor-panel">
    <div style="background: red; color: white; padding: 10px; font-weight: bold; text-align: center;">
        EDITOR IS WORKING CHECK
    </div>
    <!-- Tab Navigation -->
    <div class="editor-tabs">
        <div class="tab" [class.active]="activeTab === 'project'" (click)="toggleTab('project')">Project</div>
        <div class="tab" [class.active]="activeTab === 'resources'" (click)="toggleTab('resources')">Resources</div>
        <div class="tab" [class.active]="activeTab === 'calendars'" (click)="toggleTab('calendars')">Calendars</div>
        <div class="tab" [class.active]="activeTab === 'codes'" (click)="toggleTab('codes')">Codes</div>
    </div>

    <!-- Tab Content -->
    <div class="editor-content" (click)="deselectResource()">

        <!-- PROJECT TAB -->
        <div *ngIf="activeTab === 'project'" class="tab-pane project-pane">
            <h3>Project Settings</h3>

            <div class="project-info">
                <div class="info-row">
                    <label>Project Name:</label>
                    <span>{{ projectName() }}</span>
                </div>
                <div class="info-row">
                    <label>Start Date:</label>
                    <span>{{ projectStartDate() | date:'MMM d, y' }}</span>
                </div>
                <div class="info-row">
                    <label>End Date:</label>
                    <span>{{ projectEndDate() | date:'MMM d, y' }}</span>
                </div>
                <div class="info-row">
                    <label>Total Activities:</label>
                    <span>{{ activities().length }}</span>
                </div>
            </div>

            <div class="export-section">
                <h4>Export</h4>
                <button class="btn-export" (click)="exportToXER()">
                    üì• Export to Primavera P6 (.xer)
                </button>
            </div>

            <div class="evm-section">
                <h4>Baselines</h4>
                <button class="btn-baseline" (click)="setBaseline()">
                    üìè Set Project Baseline
                </button>
                <p class="hint-text">Snapshots current schedule as the target comparison.</p>
            </div>

            <div class="evm-section">
                <h4>Resource Analysis</h4>
                <button class="btn-baseline" style="background-color: #6741d9;" (click)="levelResources()">
                    ‚öñÔ∏è Level Resources
                </button>
                <p class="hint-text">Resolves over-allocation by delaying tasks.</p>
            </div>

            <div class="evm-section">
                <h4>EVM Analysis</h4>
                <button class="btn-s-curves" (click)="openSCurves()">
                    üìä View S-Curves Chart
                </button>
            </div>
        </div>

        <!-- RESOURCES TAB -->
        <div *ngIf="activeTab === 'resources'" class="tab-pane resources-pane">

            <!-- Header with Actions -->
            <div class="resources-header" (click)="$event.stopPropagation()">
                <div class="header-left">
                    <h3>All Resources</h3>
                    <button class="btn-profile" [disabled]="!selectedResource()" [class.active]="selectedResource()"
                        (click)="openProfile($event)">
                        Show resource usage profile
                    </button>
                </div>
                <button class="btn-add" (click)="startAddResource()" *ngIf="!showAddResourceForm">+</button>
            </div>

            <!-- Add Resource Form -->
            <div class="add-resource-form" *ngIf="showAddResourceForm" (click)="$event.stopPropagation()">
                <h4>New Resource</h4>
                <div class="form-row">
                    <input type="text" [(ngModel)]="newResource.name" placeholder="Resource Name" class="form-control"
                        autofocus>
                </div>
                <div class="form-row">
                    <select [(ngModel)]="newResource.resourceTypeId" class="form-control">
                        <option *ngFor="let type of resourceTypes()" [value]="type.id">{{ type.name }}</option>
                    </select>
                </div>
                <div class="form-row" style="display: flex; gap: 10px;">
                    <input type="number" [(ngModel)]="newResource.costPerUnit" placeholder="Cost" class="form-control"
                        style="width: 80px;">
                    <input type="text" [(ngModel)]="newResource.unit" placeholder="Unit (e.g. hour)"
                        class="form-control">
                </div>
                <div class="form-actions">
                    <button (click)="cancelAddResource()" class="btn-cancel">Cancel</button>
                    <button (click)="saveNewResource()" class="btn-save">Save</button>
                </div>
            </div>

            <!-- Resource List (No Side Panel) -->
            <div class="resource-categories">
                <div class="category-group" *ngFor="let group of resourcesByType()">

                    <!-- Category Header -->
                    <div class="category-header" [class.human]="group.name === 'Human'"
                        [class.machine]="group.name === 'Machine'" [class.material]="group.name === 'Material'"
                        (click)="toggleCategory(group.id); $event.stopPropagation()">
                        <span class="care-icon">{{ isCategoryExpanded(group.id) ? '‚ñº' : '‚ñ∂' }}</span>
                        <span class="category-name">{{ group.name }}</span>
                        <span class="count-badge">{{ group.resources.length }}</span>
                    </div>

                    <!-- Resource List -->
                    <div class="resource-list" *ngIf="isCategoryExpanded(group.id)">
                        <div class="resource-item" *ngFor="let res of group.resources"
                            [class.selected]="selectedResource() === res" (click)="selectResource(res, $event)">
                            <div class="res-name">{{ res.name }}</div>
                            <div class="res-cost">{{ res.costPerUnit | currency }} / {{ res.unit }}</div>
                        </div>
                        <div class="no-resources" *ngIf="group.resources.length === 0">
                            No resources
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- CALENDARS TAB -->
        <div *ngIf="activeTab === 'calendars'" class="tab-pane calendars-pane">

            <!-- VIEW MODE -->
            <ng-container *ngIf="!editingCalendar()">
                <div class="feature-header">
                    <h3>Work Calendars</h3>
                    <button class="btn-add-feature" (click)="startAddCalendar()">New Calendar</button>
                </div>

                <div class="calendar-list">
                    <div class="calendar-card" *ngFor="let calendar of calendars()">
                        <div class="calendar-header-row">
                            <div class="cal-name-group">
                                <h4>{{ calendar.name }}</h4>
                                <span class="default-badge" *ngIf="calendar.isDefault">Default</span>
                            </div>
                            <div class="cal-actions">
                                <button class="btn-icon edit" (click)="editCalendar(calendar)" title="Edit">‚úé</button>
                                <button class="btn-icon delete" (click)="deleteCalendar(calendar.id)"
                                    [disabled]="calendars().length <= 1" title="Delete">üóëÔ∏è</button>
                            </div>
                        </div>

                        <div class="calendar-info">
                            <div class="info-row">
                                <span class="label">Hours/Day:</span>
                                <span>{{ calendar.workHoursPerDay }}</span>
                            </div>
                            <div class="info-row">
                                <span class="label">Work Days:</span>
                                <span>{{ getWorkDaysText(calendar.workDays) }}</span>
                            </div>
                            <div class="info-row">
                                <span class="label">Holidays:</span>
                                <span>{{ calendar.holidays.length }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </ng-container>

            <!-- EDIT MODE -->
            <div *ngIf="editingCalendar()" class="calendar-editor" (click)="$event.stopPropagation()">
                <h3 class="editor-title">{{ isNewCalendar() ? 'Create Calendar' : 'Edit Calendar' }}</h3>

                <div class="form-section">
                    <label>Name</label>
                    <input type="text" [ngModel]="editingCalendar()!.name"
                        (ngModelChange)="editingCalendar()!.name = $event" class="form-control"
                        placeholder="Calendar Name">
                </div>

                <div class="form-section">
                    <label class="checkbox-label">
                        <input type="checkbox" [ngModel]="editingCalendar()!.isDefault"
                            (ngModelChange)="editingCalendar()!.isDefault = $event">
                        Set as Default Calendar
                    </label>
                </div>

                <div class="form-section">
                    <label>Work Hours Per Day</label>
                    <input type="number" [ngModel]="editingCalendar()!.workHoursPerDay"
                        (ngModelChange)="editingCalendar()!.workHoursPerDay = $event" class="form-control">
                </div>

                <div class="form-section">
                    <label>Standard Work Week</label>
                    <div class="week-days-grid">
                        <div class="day-toggle" *ngFor="let isWork of editingCalendar()!.workDays; let i = index"
                            [class.active]="isWork" (click)="toggleWorkDay(i)">
                            <span class="day-label">{{ ['S', 'M', 'T', 'W', 'T', 'F', 'S'][i] }}</span>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <label>Holidays</label>
                    <div class="holiday-input-row">
                        <input type="date" [ngModel]="newHolidayDate()" (ngModelChange)="newHolidayDate.set($event)"
                            class="form-control">
                        <button class="btn-action-small" (click)="addHoliday()">Add</button>
                    </div>
                    <div class="holidays-list">
                        <div *ngFor="let h of editingCalendar()!.holidays; let i = index" class="holiday-chip">
                            <span>{{ h | date:'mediumDate' }}</span>
                            <span class="remove-x" (click)="removeHoliday(i)">√ó</span>
                        </div>
                        <div *ngIf="editingCalendar()!.holidays.length === 0" class="no-data">No holidays defined</div>
                    </div>
                </div>

                <div class="form-actions" style="position: relative;">
                    <div *ngIf="saveError()" class="error-feedback">
                        {{ saveError() }}
                    </div>

                    <button class="btn-cancel" (click)="cancelEditCalendar()" [disabled]="isSaving()">Cancel</button>
                    <button class="btn-save" (click)="saveCalendar()" [disabled]="isSaving()">
                        <span *ngIf="!isSaving()">Save Calendar</span>
                        <span *ngIf="isSaving()" class="loader-inline">Saving...</span>
                    </button>
                </div>
            </div>

        </div>

        <!-- CODES TAB -->
        <div *ngIf="activeTab === 'codes'" class="tab-pane codes-pane">
            <div class="feature-header">
                <h3>Activity Codes</h3>
            </div>

            <!-- Add Code Definition -->
            <div class="add-code-form">
                <input type="text" [ngModel]="newCodeDefName()" (ngModelChange)="newCodeDefName.set($event)"
                    placeholder="New Code Name (e.g. Phase)" class="form-control" (keyup.enter)="startAddCodeDef()">
                <button class="btn-add-feature" (click)="startAddCodeDef()" [disabled]="!newCodeDefName()">Code
                    Definition</button>
            </div>

            <!-- List of Codes -->
            <div class="codes-list">
                <div class="code-def-card" *ngFor="let def of codeDefinitions()"
                    [class.selected]="selectedCodeDef()?.id === def.id" (click)="selectCodeDef(def)">
                    <div class="def-header">
                        <h4>{{ def.name }}</h4>
                        <button class="btn-icon delete"
                            (click)="deleteCodeDef(def.id); $event.stopPropagation()">üóëÔ∏è</button>
                    </div>
                    <div class="def-values-preview">
                        {{ def.values.length }} values
                    </div>
                </div>
            </div>

            <!-- Values Editor -->
            <div class="values-editor" *ngIf="selectedCodeDef()">
                <h4>Values for: {{ selectedCodeDef().name }}</h4>
                <div class="add-value-row">
                    <input type="text" [ngModel]="newCodeValue()" (ngModelChange)="newCodeValue.set($event)"
                        placeholder="Value Name" class="form-control">
                    <input type="color" [ngModel]="newCodeColor()" (ngModelChange)="newCodeColor.set($event)"
                        class="color-picker">
                    <button class="btn-action-small" (click)="addCodeValue()">Add</button>
                </div>
                <div class="values-list">
                    <div class="value-item" *ngFor="let val of selectedCodeDef().values">
                        <span class="color-dot" [style.background-color]="val.color"></span>
                        <span class="val-name">{{ val.value }}</span>
                        <button class="btn-icon delete-small"
                            (click)="deleteCodeValue(selectedCodeDef().id, val.id)">√ó</button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Resource Profile Modal (Reusing structure for consistency) -->


    <!-- S-Curves Modal -->
    <div class="s-curves-modal" *ngIf="showSCurves()" (click)="closeSCurves()">
        <div class="s-curves-content" (click)="$event.stopPropagation()">
            <button class="close-modal-btn" (click)="closeSCurves()">√ó</button>
            <app-s-curves-chart></app-s-curves-chart>
        </div>
    </div>
</div>