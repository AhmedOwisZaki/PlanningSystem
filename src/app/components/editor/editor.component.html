<div class="editor-panel">
    <div style="background: red; color: white; padding: 10px; font-weight: bold; text-align: center;">
        EDITOR IS WORKING CHECK
    </div>
    <!-- Tab Navigation -->
    <div class="editor-tabs">
        <div class="tab" [class.active]="activeTab === 'project'" (click)="toggleTab('project')">Project</div>
        <div class="tab" [class.active]="activeTab === 'resources'" (click)="toggleTab('resources')">Resources</div>
        <div class="tab" [class.active]="activeTab === 'calendars'" (click)="toggleTab('calendars')">Calendars</div>
        <div class="tab" [class.active]="activeTab === 'codes'" (click)="toggleTab('codes')">Codes</div>
    </div>

    <!-- Tab Content -->
    <div class="editor-content" (click)="deselectResource()">

        <!-- PROJECT TAB -->
        <div *ngIf="activeTab === 'project'" class="tab-pane project-pane">
            <h3>Project Settings</h3>

            <div class="project-info">
                <div class="info-row">
                    <label>Project Name:</label>
                    <span>{{ projectName() }}</span>
                </div>
                <div class="info-row">
                    <label>Start Date:</label>
                    <span>{{ projectStartDate() | date:'MMM d, y' }}</span>
                </div>
                <div class="info-row">
                    <label>End Date:</label>
                    <span>{{ projectEndDate() | date:'MMM d, y' }}</span>
                </div>
                <div class="info-row">
                    <label>Total Activities:</label>
                    <span>{{ activities().length }}</span>
                </div>
            </div>

            <div class="export-section">
                <h4>Export</h4>
                <button class="btn-export" (click)="exportToXER()">
                    üì• Export to Primavera P6 (.xer)
                </button>
            </div>

            <div class="evm-section">
                <h4>Baselines</h4>
                <button class="btn-baseline" (click)="setBaseline()">
                    üìè Set Project Baseline
                </button>
                <p class="hint-text">Snapshots current schedule as the target comparison.</p>
            </div>

            <div class="evm-section">
                <h4>Resource Analysis</h4>
                <button class="btn-baseline" style="background-color: #6741d9;" (click)="levelResources()">
                    ‚öñÔ∏è Level Resources
                </button>
                <p class="hint-text">Resolves over-allocation by delaying tasks.</p>
            </div>

            <div class="evm-section">
                <h4>EVM Analysis</h4>
                <button class="btn-s-curves" (click)="openSCurves()">
                    üìä View S-Curves Chart
                </button>
            </div>
        </div>

        <!-- RESOURCES TAB -->
        <div *ngIf="activeTab === 'resources'" class="tab-pane resources-pane">

            <!-- Header with Actions -->
            <div class="resources-header" (click)="$event.stopPropagation()">
                <div class="header-left">
                    <button class="btn-profile" (click)="isManagingResourceTypes.set(false)"
                        [class.active]="!isManagingResourceTypes()">
                        üì¶ All Resources
                    </button>
                    <button class="btn-profile" [disabled]="!selectedResource()" [class.active]="selectedResource()"
                        (click)="openProfile($event)">
                        Show resource usage profile
                    </button>
                    <button class="btn-profile btn-manage-types" (click)="toggleManageResourceTypes()"
                        [class.active]="isManagingResourceTypes()">
                        üè∑Ô∏è Manage types
                    </button>
                    <button class="btn-profile" (click)="toggleViewingAllAssignments()"
                        [class.active]="isViewingAllAssignments()">
                        üìä All Assignments
                    </button>
                </div>
                <button class="btn-add" (click)="startAddResource()" *ngIf="!showAddResourceForm">+</button>
            </div>

            <!-- Add Resource Form -->
            <div class="add-resource-form" *ngIf="showAddResourceForm">
                <h5 class="form-title">{{ newResource.id ? 'Edit Resource' : 'Add New Resource' }}</h5>
                <div class="form-row">
                    <label>Name <span class="hint">(e.g., Senior Architect, Excavator)</span></label>
                    <input type="text" [(ngModel)]="newResource.name" class="form-control" placeholder="Resource Name"
                        autofocus>
                </div>
                <div class="form-row">
                    <span class="field-hint">Resource category/type</span>
                    <select [(ngModel)]="newResource.resourceTypeId" class="form-control">
                        <option *ngFor="let type of (resourceTypes() || [])" [ngValue]="type.id">{{ type.name }}
                        </option>
                    </select>
                </div>
                <div class="form-row" style="display: flex; gap: 10px;">
                    <div style="flex: 1;">
                        <span class="field-hint">Rate per unit</span>
                        <input type="number" [(ngModel)]="newResource.costPerUnit" placeholder="e.g. 50.00"
                            class="form-control">
                    </div>
                    <div style="flex: 1;">
                        <span class="field-hint">UOM (e.g. hr, ton)</span>
                        <input type="text" [(ngModel)]="newResource.unit" placeholder="e.g. hour" class="form-control">
                    </div>
                </div>
                <div class="form-row">
                    <span class="field-hint">Select how this resource is managed</span>
                    <div style="display: flex; gap: 20px; align-items: center; margin-top: 5px;">
                        <label
                            style="display: flex; align-items: center; gap: 5px; cursor: pointer; font-size: 0.9rem;">
                            <input type="radio" name="baseType" [(ngModel)]="resourceBaseType" value="daily"> Daily
                        </label>
                        <label
                            style="display: flex; align-items: center; gap: 5px; cursor: pointer; font-size: 0.9rem;">
                            <input type="radio" name="baseType" [(ngModel)]="resourceBaseType" value="hourly"> Hourly
                        </label>
                    </div>
                </div>
                <div class="form-row">
                    <div *ngIf="resourceBaseType === 'daily'">
                        <span class="field-hint">Max units available per day</span>
                        <input type="number" [(ngModel)]="newResource.maxAvailabilityUnitsPerDay" class="form-control"
                            placeholder="e.g. 8">
                    </div>
                    <div *ngIf="resourceBaseType === 'hourly'">
                        <span class="field-hint">Max units available per hour</span>
                        <input type="number" [(ngModel)]="newResource.maxAvailabilityUnitsPerHour" class="form-control"
                            placeholder="e.g. 1">
                    </div>
                </div>
                <div class="form-actions">
                    <button (click)="cancelAddResource()" class="btn-cancel">Cancel</button>
                    <button (click)="saveNewResource()" class="btn-save">Save</button>
                </div>
            </div>

            <!-- Resource Type Management Pane -->
            <div class="resource-types-editor" *ngIf="isManagingResourceTypes()" (click)="$event.stopPropagation()">
                <div class="feature-header">
                    <h4>Resource Types</h4>
                    <button class="btn-add-small" (click)="startAddResourceType()"
                        *ngIf="!editingResourceType()">+</button>
                </div>

                <!-- List of Types -->
                <div class="types-list" *ngIf="!editingResourceType()">
                    <div class="type-item-card" *ngFor="let type of (resourceTypes() || [])">
                        <div class="type-info">
                            <span class="type-name">{{ type.name }}</span>
                            <span class="type-desc" *ngIf="type.description">{{ type.description }}</span>
                        </div>
                        <div class="type-actions">
                            <button class="btn-icon edit" (click)="editResourceType(type)">‚úé</button>
                            <button class="btn-icon delete" (click)="deleteResourceType(type.id)"
                                [disabled]="type.id <= 3">üóëÔ∏è</button>
                        </div>
                    </div>
                    <div class="no-data" *ngIf="(resourceTypes() || []).length === 0">No custom types defined</div>
                </div>

                <!-- Edit/Add Type Form -->
                <div class="type-edit-form" *ngIf="editingResourceType()">
                    <h5>{{ editingResourceType().id === 0 ? 'Add New Type' : 'Edit Type' }}</h5>
                    <div class="form-row">
                        <label>Name</label>
                        <input type="text" [(ngModel)]="editingResourceType().name" class="form-control"
                            placeholder="Type Name">
                    </div>
                    <div class="form-row">
                        <label>Description</label>
                        <textarea [(ngModel)]="editingResourceType().description" class="form-control"
                            placeholder="Description"></textarea>
                    </div>
                    <div class="form-actions">
                        <button (click)="cancelEditResourceType()" class="btn-cancel">Cancel</button>
                        <button (click)="saveResourceType()" class="btn-save"
                            [disabled]="isSaving() || !editingResourceType().name">
                            {{ isSaving() ? 'Saving...' : 'Save' }}
                        </button>
                    </div>
                    <div *ngIf="saveError()" class="error-text">{{ saveError() }}</div>
                </div>
            </div>

            <!-- Resource List (No Side Panel) -->
            <div class="resource-categories" *ngIf="!isManagingResourceTypes() && !isViewingAllAssignments()">
                <div class="category-group" *ngFor="let group of resourcesByType()">

                    <!-- Category Header -->
                    <div class="category-header" [class.human]="group.name === 'Human'"
                        [class.machine]="group.name === 'Machine'" [class.material]="group.name === 'Material'"
                        (click)="toggleCategory(group.id); $event.stopPropagation()">
                        <span class="care-icon">{{ isCategoryExpanded(group.id) ? '‚ñº' : '‚ñ∂' }}</span>
                        <span class="category-name">{{ group.name }}</span>
                        <span class="count-badge">{{ group.resources.length }}</span>
                    </div>

                    <!-- Resource List -->
                    <div class="resource-list" *ngIf="isCategoryExpanded(group.id)">
                        <div class="resource-item" *ngFor="let resource of group.resources"
                            (click)="selectResource(resource, $event)" (dblclick)="editResource(resource)"
                            [class.selected]="selectedResource()?.id === resource.id">
                            <div class="res-info">
                                <span class="res-name">{{ resource.name+' '+' '+' ' }}</span>
                                <span class="res-sub">{{ resource.costPerUnit }}$/{{ resource.unit
                                    }}</span>
                            </div>
                            <div class="actions">
                                <button class="btn-icon delete-stylish" (click)="deleteResource(resource, $event)"
                                    title="Delete Resource">
                                    <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
                                        <path
                                            d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="no-data" *ngIf="group.resources.length === 0">No resources</div>
                    </div>
                </div>
            </div>

            <!-- All Assignments View -->
            <div class="all-assignments-view" *ngIf="isViewingAllAssignments()" (click)="$event.stopPropagation()">
                <div class="feature-header">
                    <h4>Global Resource Assignments</h4>
                    <span class="count-badge">{{ allAssignments().length }} assignments total</span>
                </div>

                <div class="assignments-table-container">
                    <table class="assignments-table">
                        <thead>
                            <tr>
                                <th>Resource</th>
                                <th>Activity</th>
                                <th>Amount</th>
                                <th>Unit</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let ass of allAssignments()">
                                <td class="res-name-cell">{{ ass.resourceName }}</td>
                                <td class="act-name-cell">{{ ass.activityName }}</td>
                                <td class="amount-cell">{{ ass.amount }}</td>
                                <td class="unit-cell">{{ ass.unit }}</td>
                            </tr>
                            <tr *ngIf="allAssignments().length === 0">
                                <td colspan="4" class="no-data">No resource assignments found in this project.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

        </div>

        <!-- CALENDARS TAB -->
        <div *ngIf="activeTab === 'calendars'" class="tab-pane calendars-pane">

            <!-- VIEW MODE -->
            <ng-container *ngIf="!editingCalendar()">
                <div class="feature-header">
                    <h3>Work Calendars</h3>
                    <button class="btn-add-feature" (click)="startAddCalendar()">New Calendar</button>
                </div>

                <div class="calendar-list">
                    <div class="calendar-card" *ngFor="let calendar of calendars()">
                        <div class="calendar-header-row">
                            <div class="cal-name-group">
                                <h4>{{ calendar.name }}</h4>
                                <span class="default-badge" *ngIf="calendar.isDefault">Default</span>
                            </div>
                            <div class="cal-actions">
                                <button class="btn-icon edit" (click)="editCalendar(calendar)" title="Edit">‚úé</button>
                                <button class="btn-icon delete" (click)="deleteCalendar(calendar.id)"
                                    [disabled]="calendars().length <= 1" title="Delete">üóëÔ∏è</button>
                            </div>
                        </div>

                        <div class="calendar-info">
                            <div class="info-row">
                                <span class="label">Hours/Day:</span>
                                <span>{{ calendar.workHoursPerDay }}</span>
                            </div>
                            <div class="info-row">
                                <span class="label">Work Days:</span>
                                <span>{{ getWorkDaysText(calendar.workDays) }}</span>
                            </div>
                            <div class="info-row">
                                <span class="label">Holidays:</span>
                                <span>{{ calendar.holidays.length }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </ng-container>

            <!-- EDIT MODE -->
            <div *ngIf="editingCalendar()" class="calendar-editor" (click)="$event.stopPropagation()">
                <h3 class="editor-title">{{ isNewCalendar() ? 'Create Calendar' : 'Edit Calendar' }}</h3>

                <div class="form-section">
                    <label>Name</label>
                    <input type="text" [ngModel]="editingCalendar()!.name"
                        (ngModelChange)="editingCalendar()!.name = $event" class="form-control"
                        placeholder="Calendar Name">
                </div>

                <div class="form-section">
                    <label class="checkbox-label">
                        <input type="checkbox" [ngModel]="editingCalendar()!.isDefault"
                            (ngModelChange)="editingCalendar()!.isDefault = $event">
                        Set as Default Calendar
                    </label>
                </div>

                <div class="form-section">
                    <label>Work Hours Per Day</label>
                    <input type="number" [ngModel]="editingCalendar()!.workHoursPerDay"
                        (ngModelChange)="editingCalendar()!.workHoursPerDay = $event" class="form-control">
                </div>

                <div class="form-section">
                    <label>Standard Work Week</label>
                    <div class="week-days-grid">
                        <div class="day-toggle" *ngFor="let isWork of editingCalendar()!.workDays; let i = index"
                            [class.active]="isWork" (click)="toggleWorkDay(i)">
                            <span class="day-label">{{ ['S', 'M', 'T', 'W', 'T', 'F', 'S'][i] }}</span>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <label>Holidays</label>
                    <div class="holiday-input-row">
                        <input type="date" [ngModel]="newHolidayDate()" (ngModelChange)="newHolidayDate.set($event)"
                            class="form-control">
                        <button class="btn-action-small" (click)="addHoliday()">Add</button>
                    </div>
                    <div class="holidays-list">
                        <div *ngFor="let h of editingCalendar()!.holidays; let i = index" class="holiday-chip">
                            <span>{{ h | date:'mediumDate' }}</span>
                            <span class="remove-x" (click)="removeHoliday(i)">√ó</span>
                        </div>
                        <div *ngIf="editingCalendar()!.holidays.length === 0" class="no-data">No holidays defined</div>
                    </div>
                </div>

                <div class="form-actions" style="position: relative;">
                    <div *ngIf="saveError()" class="error-feedback">
                        {{ saveError() }}
                    </div>

                    <button class="btn-cancel" (click)="cancelEditCalendar()" [disabled]="isSaving()">Cancel</button>
                    <button class="btn-save" (click)="saveCalendar()" [disabled]="isSaving()">
                        <span *ngIf="!isSaving()">Save Calendar</span>
                        <span *ngIf="isSaving()" class="loader-inline">Saving...</span>
                    </button>
                </div>
            </div>

        </div>

        <!-- CODES TAB -->
        <div *ngIf="activeTab === 'codes'" class="tab-pane codes-pane">
            <div class="feature-header">
                <h3>Activity Codes</h3>
            </div>

            <!-- Add Code Definition -->
            <div class="add-code-form">
                <input type="text" [ngModel]="newCodeDefName()" (ngModelChange)="newCodeDefName.set($event)"
                    placeholder="New Code Name (e.g. Phase)" class="form-control" (keyup.enter)="startAddCodeDef()">
                <button class="btn-add-feature" (click)="startAddCodeDef()" [disabled]="!newCodeDefName()">Code
                    Definition</button>
            </div>

            <!-- List of Codes -->
            <div class="codes-list">
                <div class="code-def-card" *ngFor="let def of codeDefinitions()"
                    [class.selected]="selectedCodeDef()?.id === def.id" (click)="selectCodeDef(def)">
                    <div class="def-header">
                        <h4>{{ def.name }}</h4>
                        <button class="btn-icon delete"
                            (click)="deleteCodeDef(def.id); $event.stopPropagation()">üóëÔ∏è</button>
                    </div>
                    <div class="def-values-preview">
                        {{ def.values.length }} values
                    </div>
                </div>
            </div>

            <!-- Values Editor -->
            <div class="values-editor" *ngIf="selectedCodeDef()">
                <h4>Values for: {{ selectedCodeDef().name }}</h4>
                <div class="add-value-row">
                    <input type="text" [ngModel]="newCodeValue()" (ngModelChange)="newCodeValue.set($event)"
                        placeholder="Value Name" class="form-control">
                    <input type="color" [ngModel]="newCodeColor()" (ngModelChange)="newCodeColor.set($event)"
                        class="color-picker">
                    <button class="btn-action-small" (click)="addCodeValue()">Add</button>
                </div>
                <div class="values-list">
                    <div class="value-item" *ngFor="let val of selectedCodeDef().values">
                        <span class="color-dot" [style.background-color]="val.color"></span>
                        <span class="val-name">{{ val.value }}</span>
                        <button class="btn-icon delete-small"
                            (click)="deleteCodeValue(selectedCodeDef().id, val.id)">√ó</button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Resource Profile Modal (Reusing structure for consistency) -->


    <!-- S-Curves Modal -->
    <div class="s-curves-modal" *ngIf="showSCurves()" (click)="closeSCurves()">
        <div class="s-curves-content" (click)="$event.stopPropagation()">
            <button class="close-modal-btn" (click)="closeSCurves()">√ó</button>
            <app-s-curves-chart></app-s-curves-chart>
        </div>
    </div>
</div>