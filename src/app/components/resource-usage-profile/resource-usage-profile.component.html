<div class="profile-container">
    <div class="y-axis">
        <!-- Simple scale generation -->
        <div class="scale-label top">{{ maxUsage() | number:'1.0-0' }}</div>
        <div class="scale-label mid">{{ maxUsage() / 2 | number:'1.0-0' }}</div>
        <div class="scale-label bottom">0</div>
    </div>
    <div class="chart-area">
        <!-- SVG Chart -->
        <!-- Note: Width needs to match Gantt Timeline exactly -->
        <!-- We use absolute positioning for bars to mimic Gantt cells -->
        <!-- We use absolute positioning for bars to mimic Gantt cells -->
        <div class="bars-wrapper" [style.width.px]="totalWidth()">
            <div class="bar-column" *ngFor="let day of aggregatedData(); let i = index" [style.left.px]="getLeft(i)"
                [style.width.px]="dayWidth * zoomLevel">

                <div class="bar-chart-surface">
                    <!-- Bar Fill: Safe Part -->
                    <div class="bar-fill base" [style.height.%]="getBarHeight(day.safeTotal)">
                    </div>

                    <!-- Bar Fill: Over Part -->
                    <div class="bar-fill over" *ngIf="day.overTotal > 0" [style.height.%]="getBarHeight(day.overTotal)"
                        [style.bottom.%]="getBarHeight(day.limit)">
                    </div>

                    <!-- Common Tooltip: Positioned at total height -->
                    <span class="tooltip" [style.bottom.%]="getBarHeight(day.total)">
                        {{ day.date | date:'shortDate' }}: {{ day.total | number:'1.1-2' }} / {{ day.limit }}
                    </span>

                    <!-- Limit Marker -->
                    <div class="limit-marker" [style.bottom.%]="getBarHeight(day.limit)">
                        <span class="limit-val" *ngIf="i === 0">{{ day.limit }}</span>
                    </div>
                </div>

                <!-- X Axis Date Label -->
                <div class="date-label">
                    {{ day.date | date:'d' }}
                </div>

                <!-- Month Label (First of Month) -->
                <div class="month-label" *ngIf="day.date.getDate() === 1 || i === 0">
                    {{ day.date | date:'MMM yyyy' }}
                </div>
            </div>
        </div>
    </div>
</div>